# script créé le : Thu Oct 31 09:39:19 CET 2013 -   syntaxe MySQL ;
#FERJEUX, AMAURY, STEPHANE
#PROJET QUIZZ
# use  QUIZZ ;

DROP TABLE IF EXISTS QUIZZ ;
CREATE TABLE QUIZZ (id_quizz int AUTO_INCREMENT NOT NULL,
date_creation DATE NOT NULL,
date_maj DATE,
id_difficulte INT,
id_theme INT,
id_admin INT,
PRIMARY KEY (id_quizz) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS ADMINISTRATEUR ;
CREATE TABLE ADMINISTRATEUR (id_admin int AUTO_INCREMENT NOT NULL,
login_admin VARCHAR(100) NOT NULL,
mdp_admin VARCHAR(20) NOT NULL,
PRIMARY KEY (id_admin) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS JOUEUR ;
CREATE TABLE JOUEUR (id_joueur int AUTO_INCREMENT NOT NULL,
login_joueur VARCHAR(50) NOT NULL,
mdp_joueur VARCHAR(20) NOT NULL,
PRIMARY KEY (id_joueur) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS DIFFICULTE ;
CREATE TABLE DIFFICULTE (id_difficulte int AUTO_INCREMENT NOT NULL,
libelle_difficulte VARCHAR(20) NOT NULL,
temps_difficulte DATE NOT NULL,
PRIMARY KEY (id_difficulte) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS THEME ;
CREATE TABLE THEME (id_theme int AUTO_INCREMENT NOT NULL,
libelle_theme VARCHAR(50) NOT NULL,
PRIMARY KEY (id_theme) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS REPONSE ;
CREATE TABLE REPONSE (id_reponse int AUTO_INCREMENT NOT NULL,
réponse_texte VARCHAR(2000),
reponse_image VARCHAR(100),
id_quizz INT NOT NULL,
PRIMARY KEY (id_reponse) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS QUESTION ;
CREATE TABLE QUESTION (id_question int AUTO_INCREMENT NOT NULL,
question_texte VARCHAR(2000),
question_image VARCHAR(100),
id_quizz INT NOT NULL,
PRIMARY KEY (id_question) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS SCORE ;
CREATE TABLE SCORE (id_score int AUTO_INCREMENT NOT NULL,
score INT NOT NULL,
id_joueur INT NOT NULL,
id_quizz INT NOT NULL,
PRIMARY KEY (id_score) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS manipuler ;
CREATE TABLE manipuler (id_admin int AUTO_INCREMENT NOT NULL,
id_quizz INT NOT NULL,
PRIMARY KEY (id_admin,
 id_quizz) ) ENGINE=InnoDB;

DROP TABLE IF EXISTS participer ;
CREATE TABLE participer (id_joueur int AUTO_INCREMENT NOT NULL,
id_quizz INT NOT NULL,
temps_debut DATE,
PRIMARY KEY (id_joueur,
 id_quizz) ) ENGINE=InnoDB;

ALTER TABLE QUIZZ ADD CONSTRAINT FK_QUIZZ_id_difficulte FOREIGN KEY (id_difficulte) REFERENCES DIFFICULTE (id_difficulte);

ALTER TABLE QUIZZ ADD CONSTRAINT FK_QUIZZ_id_theme FOREIGN KEY (id_theme) REFERENCES THEME (id_theme);
ALTER TABLE QUIZZ ADD CONSTRAINT FK_QUIZZ_id_admin FOREIGN KEY (id_admin) REFERENCES ADMINISTRATEUR (id_admin);
ALTER TABLE REPONSE ADD CONSTRAINT FK_REPONSE_id_quizz FOREIGN KEY (id_quizz) REFERENCES QUIZZ (id_quizz);
ALTER TABLE QUESTION ADD CONSTRAINT FK_QUESTION_id_quizz FOREIGN KEY (id_quizz) REFERENCES QUIZZ (id_quizz);
ALTER TABLE SCORE ADD CONSTRAINT FK_SCORE_id_joueur FOREIGN KEY (id_joueur) REFERENCES JOUEUR (id_joueur);
ALTER TABLE SCORE ADD CONSTRAINT FK_SCORE_id_quizz FOREIGN KEY (id_quizz) REFERENCES QUIZZ (id_quizz);
ALTER TABLE manipuler ADD CONSTRAINT FK_manipuler_id_admin FOREIGN KEY (id_admin) REFERENCES ADMINISTRATEUR (id_admin);
ALTER TABLE manipuler ADD CONSTRAINT FK_manipuler_id_quizz FOREIGN KEY (id_quizz) REFERENCES QUIZZ (id_quizz);
ALTER TABLE participer ADD CONSTRAINT FK_participer_id_joueur FOREIGN KEY (id_joueur) REFERENCES JOUEUR (id_joueur);
ALTER TABLE participer ADD CONSTRAINT FK_participer_id_quizz FOREIGN KEY (id_quizz) REFERENCES QUIZZ (id_quizz);
